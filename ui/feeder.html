<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>PLOD feeder</title>
    <!--<script type="text/javascript" src="template.js"></script>-->

    <!--script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script-->

    <link rel="stylesheet" href="datetimepicker-master/jquery.datetimepicker.css">
    <script type="text/javascript" src="datetimepicker-master/jquery.js"></script>
    <script type="text/javascript" src="datetimepicker-master/build/jquery.datetimepicker.full.min.js"></script>

    <script type="text/javascript">

var SERVER_PATH = '';
var DEBUG_XHR = false;

jQuery.datetimepicker.setLocale("ja");

/*
 * NOTE: if you change the value of the lists.
 * you have to check value_selected in below functions.
 *     add_input_select_to_obj()
 *     add_input_select_freetext_to_obj()
 *     add_input_select_options_to_obj()
 */

/* publisher */
const publisherList = [
    { "key":"厚労省", "value":"MHLW" },
    { "key":"茨城県", "value":"Ibaraki" },
    { "key":"神奈川県", "value":"Kanagawa" },
    { "key":"群馬県", "value":"Gunma" },
    { "key":"埼玉県", "value":"Saitama" },
    { "key":"千葉県", "value":"Chiba" },
    { "key":"東京都", "value":"Tokyo" },
    { "key":"栃木県", "value":"Tochigi" },
];

/* location */
const locationList = [
    { "key":"茨城県", "value":"gnjp:Ibaraki" },
    { "key":"神奈川県", "value":"gnjp:Kanagawa" },
    { "key":"群馬県", "value":"gnjp:Gunma" },
    { "key":"埼玉県", "value":"gnjp:Saitama" },
    { "key":"千葉県", "value":"gnjp:Chiba" },
    { "key":"東京都", "value":"gnjp:Tokyo" },
    { "key":"栃木県", "value":"gnjp:Tochigi" },
];

/* age */
const ageList = [
    { "key":"0-9",  "value":"0s" },
    { "key":"10代", "value":"10s" },
    { "key":"20代", "value":"20s" },
    { "key":"30代", "value":"30s" },
    { "key":"40代", "value":"40s" },
    { "key":"50代", "value":"50s" },
    { "key":"60代", "value":"60s" },
    { "key":"70代", "value":"70s" },
    { "key":"80代", "value":"80s" },
    { "key":"90代", "value":"90s" },
    { "key":"非公開", "value":"Unspecified" },
];

/* gender */
const genderList = [
    { "key":"男性", "value":"Male" },
    { "key":"女性", "value":"Female" },
    { "key":"非公開", "value":"Unspecified" },
];

/* disease */
const diseaseList = [
    { "key":"新型コロナウイルス", "value":"covid2019" },
    { "key":"麻疹", "value":"Measles" },
    { "key":"未確定", "value":"Unconfirmed" },
];

/* patientCondition + postfix */
const patientConditionList = [
    { "key": "倦怠感", "postfix": "Malaise" },
    { "key": "喀痰", "postfix": "Sputum" },
    { "key": "発熱", "postfix": "Fever" },
    { "key": "悪寒", "postfix": "Chill" },
    { "key": "咳", "postfix": "Cough" },
    { "key": "鼻水", "postfix": "Cough" },
    { "key": "入院", "postfix": "Hospitalized" },
    { "key": "陽性", "postfix": "Positive" },
];

/* transportationMethod + postfix */
const transportationMethodList = [
    { "key": "タクシー", "postfix": "Taxi" },
    { "key": "バス", "postfix": "Bus" },
    { "key": "電車", "postfix": "Train" },
    { "key": "飛行機", "postfix": "Airplane" },
    { "key": "船", "postfix": "Ship" },
    { "key": "徒歩", "postfix": "Walk" },
    { "key": "自家用車・自転車・バイク", "postfix": "Bike" },
]

window.addEventListener("load", ev_load, false);

let row_num = 0;

function debug_table(table)
{
    console.log("xxx === debug_table() ===");
    for (var r = 0, n = table.rows.length; r < n; r++) {
        for (var c = 0, m = table.rows[r].cells.length; c < m; c++) {
            console.log("xxx cell():", r, c, table.rows[r].cells[c]);
        }
    }
}

function get_row_num()
{
    // no purpose than making a cell to be unique. 
    row_num += 1;
    return row_num;
}

function add_input_checkbox_freetext_to_obj(parent_obj, target_name, item_list)
{
    /*
     * add target_name + postfix as the name of the checkboxes.
     * don't use id to identify a checkbox.
     */
    let div_obj, x;

    item_list.forEach(kv => {
        div_obj = document.createElement("div")

        x = document.createElement("input");
        x.type = "checkbox";
        x.name = target_name+kv["postfix"];
        div_obj.appendChild(x);

        x = document.createElement("label")
        x.htmlFor = target_name+kv["postfix"]
        x.appendChild(document.createTextNode(kv["key"]));
        div_obj.appendChild(x);

        parent_obj.appendChild(div_obj);
    });

    div_obj = document.createElement("div")

    x = document.createElement("label")
    x.htmlFor = target_name + "FreeText"
    x.appendChild(document.createTextNode("その他"));
    div_obj.appendChild(x);

    x = document.createElement("textarea");
    x.name = target_name + "FreeText"
    x.placeholder = "備考など自由記述";
    div_obj.appendChild(x);

    parent_obj.appendChild(div_obj);
}

function add_input_select_options_to_obj(parent_obj, opts, value_selected)
{
    /*
     * parent_obj, not parent_id, should be passed here.
     * because the parent_id is not listed in the document level list.
     */
    opts.forEach(x => {
        let opt = document.createElement("option");
        opt.text = x["key"];
        opt.value = x["value"];
        if (value_selected != null && x["value"] == value_selected) {
            opt.selected = true;
        }
        parent_obj.add(opt, null);
    });
}

function add_input_select_to_obj(parent_obj, target_id, select_opts, value_selected)
{
    let x, x2;

    x = document.createElement("div");
    x2 = document.createElement("select");
    x2.id = target_id + "Selected";
    add_input_select_options_to_obj(x2, select_opts, value_selected);
    x.appendChild(x2);

    parent_obj.appendChild(x);
}

function add_input_select_freetext_to_obj(parent_obj, target_id, select_opts, value_selected)
{
    let x, x2, x3;

    x = document.createElement("div");
    x2 = document.createElement("select");
    x2.id = target_id + "Selected";
    add_input_select_options_to_obj(x2, select_opts.concat({ "key":"その他", "value":"Others" }), value_selected);
    x.appendChild(x2);

    x2 = document.createElement("div");
    //x2.classList.add(target_id + "FreeTextBlock");
    x2.id = target_id + "FreeTextBlock";
    x2.appendChild(document.createTextNode("その他"));
    x3 = document.createElement("input");
    x3.type = "text";
    x3.id = target_id + "FreeText";
    x3.placeholder = "選択肢にない場合に入力する。";
    x2.appendChild(x3);
    x.appendChild(x2);

    parent_obj.appendChild(x);
}

function get_current_date()
{
    let local_time = new Date();
    return local_time.toJSON().slice(0,10);
}

function add_input_date_to_obj(parent_obj, target_id)
{
    let x = document.createElement("input");
    x.type = "text";
    x.id = target_id;
    parent_obj.appendChild(x);
    jQuery(`#${x.id}`).val(get_current_date());
    jQuery(`#${x.id}`).datetimepicker({ format: "Y-m-d", timepicker: false, });
    console.log("=== xxx add time", x.id);
    console.log(parent_obj);
}

function add_input_time_to_obj(parent_obj, target_id)
{
    let local_time = new Date();
    let x = document.createElement("input");
    x.type = "text";
    x.id = target_id;
    parent_obj.appendChild(x);
    jQuery(`#${x.id}`).datetimepicker({ datepicker: false, format: "H:i", minTime: "00:00", maxTime: "24:00", step: 30, defaultTime: "12:00" });
}

function add_input_date_time_to_obj(parent_obj, target_date_id, target_time_id, line_break)
{
    add_input_date_to_obj(parent_obj, target_date_id);
    if (target_time_id != null) {
        if (line_break == true) {
            parent_obj.appendChild(document.createElement("br"));
        }
        add_input_time_to_obj(parent_obj, target_time_id);
    }
}

function add_input_textarea_to_obj(parent_obj, target_id)
{
    let x = document.createElement("textarea");
    x.id = target_id;
    x.placeholder = "備考など自由記述";
    parent_obj.appendChild(x);
}

function add_input_del_line_to_obj(parent_obj, row)
{
    let x = document.createElement("input");
    x.class = "inputDelLine"
    x.type="button";
    x.value = "削除";
    x.addEventListener("click", function(){ ev_click_del_line(row) }, false);
    parent_obj.appendChild(x);
}

function add_line_patient_location_history()
{
    let table = document.getElementById("tablePatientLocationHistory");
    let row = table.insertRow(-1);
    let row_index = table.rows.length;
    let row_num = get_row_num();
    let x, x2, x3, cell;

    /* "出発時間",
        patientLocationHistoryDepartureDate, date
        patientLocationHistoryDepartureTime, time
     */
    cell = row.insertCell(-1);
    add_input_date_time_to_obj(cell, "patientLocationHistoryDepartureDate" + row_num, "patientLocationHistoryDepartureTime" + row_num, true);

    /* "出発地", patientLocationHistoryDepartureFrom, select+text */
    cell = row.insertCell(-1);
    add_input_select_freetext_to_obj(cell, "patientLocationHistoryDepartureFrom" + row_num, locationList, "gnjp:Tokyo");

    /* "到着時間", patientLocationHistoryArrivalDateTime, date+time */
    cell = row.insertCell(-1);
    add_input_date_time_to_obj(cell, "patientLocationHistoryArrivalDate" + row_num, "patientLocationHistoryArrivalTime" + row_num, true);

    /* "目的地", patientLocationHistoryArrivalTo, select+text */
    cell = row.insertCell(-1);
    add_input_select_freetext_to_obj(cell, "patientLocationHistoryArrivalTo" + row_num, locationList, "Others");

    /* "移動手段", transportationMethod, select+text */
    cell = row.insertCell(-1);
    add_input_checkbox_freetext_to_obj(cell, "transportationMethod", transportationMethodList);

    /* "所見や患者の行動、その他", patientLocationHistoryDetail, text */
    cell = row.insertCell(-1);
    add_input_textarea_to_obj(cell, "patientLocationHistoryDetail" + row_num);

    /* DelLine */
    cell = row.insertCell(-1);
    add_input_del_line_to_obj(cell, row);
}

function add_line_patient_condition_history()
{
    let table = document.getElementById("tablePatientConditionHistory");
    let row = table.insertRow(-1);
    let row_index = table.rows.length;
    let row_num = get_row_num();
    let x, x2, x3, cell;

    /*
     "日付", cellPatientConditionHistoryDateTime, date+time
        patientConditionHistoryDate, date
        patientConditionHistoryTime, time
    */
    cell = row.insertCell(-1);
    add_input_date_time_to_obj(cell, "patientConditionHistoryDate" + row_num, "patientConditionHistoryTime" + row_num, true);

    /* "健康状態", patientConditionHistoryStatus, checkbox+text */
    cell = row.insertCell(-1);
    add_input_checkbox_freetext_to_obj(cell, "patientConditionHistoryStatus", patientConditionList);

    /* "所見や患者の行動、その他", patientConditionHistoryDetail, text */
    cell = row.insertCell(-1);
    add_input_textarea_to_obj(cell, "patientConditionHistoryDetail" + row_num);

    /* DelLine */
    cell = row.insertCell(-1);
    add_input_del_line_to_obj(cell, row);
}

/*
 * functions for submission
 */
/* XXX delete post_request() when you confirm whether this program can work on a cell phone */
/*
function post_request(url, callback, request)
{
    let xhr = new XMLHttpRequest();

    if (DEBUG_XHR === false) {
        xhr.open('POST', url, true);
        xhr.setRequestHeader('Content-Type', 'application/json;charset=UTF-8');
    } else {
        m = 'UNSENT:' + xhr.readyState; // readyState will be 0
        console.log(m);

        xhr.open('POST', url, true);

        m = 'OPENED:' + xhr.readyState; // readyState will be 1
        console.log(m);

        xhr.setRequestHeader('Content-Type', 'application/json;charset=UTF-8');

        xhr.onprogress = function () {
            m = 'LOADING:' + xhr.readyState; // readyState will be 3
            console.log(m);
        }

        xhr.onload = function () {
            m = 'DONE' + xhr.readyState; // readyState will be 4
            console.log(m);
            console.log('this=', this);
            console.log('load:', JSON.parse(xhr.responseText));
        }
    }

    xhr.onreadystatechange = function() {
        console.log('xhr state:', xhr.readyState);
        if (xhr.readyState === 4) {
            callback(xhr.status == 200 ? JSON.parse(xhr.responseText) : null);
        }
    }

    xhr.send(JSON.stringify(request));
}
*/

function get_selected_value(target_id)
{
    //console.log("get_selected_value=", target_id);
    let x = document.getElementById(target_id);
    let selected_value = x.options[x.selectedIndex].value;
    if (selected_value != "") {
        return selected_value;
    } else {
        return undefined;
    }
}

function get_element_by_regex(parent_obj, target_regex)
{
    let x, a;

    if (parent_obj.id && parent_obj.id.match(target_regex)) {
        console.log("==> match", parent_obj.id);
        return parent_obj;
    }

    if (parent_obj.children == undefined) {
        return undefined;
    }

    /* first, walk this level. */
    for (let i = 0; i < parent_obj.childNodes.length; i++) {
        x = parent_obj.childNodes[i];
        //console.log("==> xxx by_regex:", i, x.id, target_regex, x);
        a = get_element_by_regex(x, target_regex);
        if (a != undefined) {
            return a;
        }
    }

    return undefined;
}

function get_one_value(target_id, a, b)
{
    if (b == "" || b == undefined) {
        return a;
    } else {
        if (a != "Others") {
            window.alert(target_id + `: ${a}を選択され、かつ、その他のフィールドに ${b} が入っています。`);
            return null;
        }
        return b;
    }
}

function get_value_select_freetext_in_obj(parent_obj, target_id)
{
    //console.log("xxx in_obj 0:", parent_obj, target_id);
    let ax = get_element_by_regex(parent_obj, new RegExp(`${target_id}\\d+Selected$`));
    let a = ax.options[ax.selectedIndex].value;
    //console.log("xxx a=", a);
    let bx = get_element_by_regex(parent_obj, new RegExp(`${target_id}\\d+FreeText$`));
    let b = bx.value;
    //console.log("xxx b=", b);
    return get_one_value(target_id, a, b);
}

function get_value_select_freetext(target_id)
{
    let a = get_selected_value(target_id + "Selected");
    let b = document.getElementById(target_id + "FreeText").value;
    return get_one_value(target_id, a, b);
}

function make_patient_data()
{
    let created_data = {
        "publisher": get_value_select_freetext("publisher"),
        "patientDisease": get_value_select_freetext("patientDisease"),
        "dateConfirmed": jQuery("#dateConfirmed").val(),
        "patientAge": get_selected_value("patientAgeSelected"),
        "patientGender": get_selected_value("patientGenderSelected"),
        "patientResidence": get_value_select_freetext("patientResidence"),
        "patientLocationHistory": [
        ],
        "patientConditionHistory": [
        ]
    };
    let table;

    table = document.getElementById("tablePatientLocationHistory");
    debug_table(table);

    for (let i = 1; i < table.rows.length; i++) {
        //console.log("xxx LH table:", i, table.rows[i]);
        let kv = {};
        row = table.rows[i];
        kv["patientLocationHistoryDepartureDate"] = get_element_by_regex(row.cells[0], new RegExp("patientLocationHistoryDepartureDate\\d+$")).value;
        kv["patientLocationHistoryDepartureTime"] = get_element_by_regex(row.cells[0], new RegExp("patientLocationHistoryDepartureTime\\d+$")).value;
        kv["patientLocationHistoryDepartureFrom"] = get_value_select_freetext_in_obj(row.cells[1], "patientLocationHistoryDepartureFrom");
        kv["patientLocationHistoryArrivalDate"] = get_element_by_regex(row.cells[2], new RegExp("patientLocationHistoryArrivalDate\\d+$")).value;
        kv["patientLocationHistoryArrivalTime"] = get_element_by_regex(row.cells[2], new RegExp("patientLocationHistoryArrivalTime\\d+$")).value;
        kv["patientLocationHistoryArrivalTo"] = get_value_select_freetext_in_obj(row.cells[3], "patientLocationHistoryArrivalTo");
        row.cells[4].childNodes.forEach(x => { // transportationMethod
            x.childNodes.forEach(y => {
                if (y.type == "checkbox") {
                    kv[y.name] = y.checked;
                }
                if (y.type == "textarea") {
                    kv[y.name] = y.value;
                }
            });
        });
        kv["patientLocationHistoryDetail"] = get_element_by_regex(row.cells[5], new RegExp("patientLocationHistoryDetail\\d+$")).value;
        created_data["patientLocationHistory"].push(kv);
    }

    table = document.getElementById("tablePatientConditionHistory");
    debug_table(table);

    for (let i = 1; i < table.rows.length; i++) {
        //console.log("xxx LH table:", i, table.rows[i]);
        let kv = {};
        kv["patientConditionHistoryDate"] = get_element_by_regex(row.cells[0], new RegExp("patientConditionHistoryDate\\d+$")).value;
        kv["patientConditionHistoryTime"] = get_element_by_regex(row.cells[0], new RegExp("patientConditionHistoryTime\\d+$")).value;
        row.cells[1].childNodes.forEach(x => { // patientConditionHistoryStatus
            x.childNodes.forEach(y => {
                if (y.type == "checkbox") {
                    kv[y.name] = y.checked;
                }
                if (y.type == "textarea") {
                    kv[y.name] = y.value;
                }
            });
        });
        kv["patientConditionHistoryDetail"] = get_element_by_regex(row.cells[2], new RegExp("patientConditionHistoryDetail\\d+$")).value;
        created_data["patientConditionHistory"].push(kv);
    }

    console.log("created_data=", created_data);
    return created_data;
}

function send_patient_data(patient_data)
{
    $.ajax({
        url: SERVER_PATH + "/beak",
        type: "POST",
        dataType: "text",
        data: JSON.stringify(patient_data)
    }).done(function(content) {
        console.log("callback=", content);
        if (content) {
            content = JSON.parse(content);
            confirm("EventID " + content["result"]["event_id"] + " で、登録されました。");
            //put_current_value(content);
        }
    });
    /*
    if (Object.keys(patient_data).length != 0) {
        // post only if any value are changed.
        post_request(SERVER_PATH + '/beak', function(content) {
                console.log("callback=", content);
                if (content) {
                    confirm("EventID " + content["result"]["event_id"] +
                        " で、登録されました。");
                    //put_current_value(content);
                }
            },
            patient_data);
    }
    */
}

/*
 * event handlers
 */
function ev_click_add_line_patient_location_history()
{
    add_line_patient_location_history();
}

function ev_click_add_line_patient_condition_history()
{
    add_line_patient_condition_history();
}

function ev_click_del_line(row)
{
    if (true == confirm("削除しますか？")) {
        row.parentNode.deleteRow(row.sectionRowIndex);
    }
}

function ev_click_submit(a)
{
    if (true == confirm("登録しますか？")) {
        send_patient_data(make_patient_data());
    }
}

function ev_click_confirm(a)
{
    let created_data = make_patient_data();

    let x = document.getElementById("confirmMessage");
    x.innerText = JSON.stringify(created_data, undefined, 2);

    $('.js-modal').fadeIn();

    $('.js-modal-close-no').on('click',function(){
        $('.js-modal').fadeOut();
        return false;
    });

    $('#js-modal-close-yes').on('click',function(){
        $('.js-modal').fadeOut();
        send_patient_data(make_patient_data());
        return false;
    });

    /*
    let ret = confirm(JSON.stringify(created_data, undefined, 2) + "<br>登録しますか？");
    if (ret == true) {
        send_patient_data(created_data);
    }
    */
}

function ev_load(e)
{
    let parent_obj;

    add_input_select_freetext_to_obj(document.getElementById("divPublisher"), "publisher", publisherList, "MHLW");

    jQuery("#dateConfirmed").val(get_current_date());
    jQuery("#dateConfirmed, #datePicker2").datetimepicker({ format: "Y-m-d", timepicker: false, });

    add_input_select_to_obj(document.getElementById("divPatientAge"), "patientAge", ageList, "Unspecified");

    add_input_select_to_obj(document.getElementById("divPatientGender"), "patientGender", genderList, "Unspecified");

    add_input_select_freetext_to_obj(document.getElementById("divPatientDisease"), "patientDisease", diseaseList, "covid2019");

    add_input_select_freetext_to_obj(document.getElementById("divPatientResidence"), "patientResidence", locationList, "gnjp:Tokyo");

    document.getElementById("addLinePatientLocationHistory").addEventListener("click", ev_click_add_line_patient_location_history, false);
    add_line_patient_location_history();

    document.getElementById("addLinePatientConditionHistory").addEventListener("click", ev_click_add_line_patient_condition_history, false);
    //add_line_patient_condition_history();
    //add_line_patient_condition_history();

    document.getElementById("confirmButton").addEventListener("click", ev_click_confirm, false);
    document.getElementById("submitButton").addEventListener("click", ev_click_submit, false);
}

    </script>

    <!-- link rel="stylesheet" type="text/css" href="feeder.css" -->
    <style type="text/css">
    .divBlock { display: inline-block; padding: 5px; margin-bottom: 5px; border: 1px dotted #333333; }
    #divBlockPublisher, #divBlockPatientDisease, #divBlockDateConfirmed,
    #divBlockPatientAge, #divBlockPatientGender, #divBlockPatientResidence
    { display: inline-block; padding: 10px; border: 1px dotted #333333; }

    #divPublisher, #publisherSelected, #publisherFreeTextBlock { display: inline-block; }
    #divPatientDisease, #patientDiseaseSelected, #patientDiseaseFreeTextBlock { display: inline-block; }
    #divDateConfirmed, #dateConfirmed { display: inline-block; }
    #divPatientResidence, #patientResidenceSelected, #patientResidenceFreeTextBlock { display: inline-block; }
    #divPatientAge, #patientAgeSelected { display: inline-block; }
    #divPatientGender, #patientGenderSelected { display: inline-block; }
    #plodLogo { float:left; margin-right: 10px; }

    .modal {
        display: none;
        height: 100vh;
        position: fixed;
        top: 0;
        width: 100%;
    }
    .modal-bg {
        background: rgba(0,0,0,0.8);
        height: 100vh;
        position: absolute;
        width: 100%;
    }
    #modal-content {
        background: #fff;
        left: 50%;
        padding: 40px;
        position: absolute;
        top: 50%;
        transform: translate(-50%,-50%);
        width: 60%;
        height: 80%;
        overflow: auto;
    }
    #confirmMessage {
        font-family: monospace;
        font-size: 18px;
    }

    .description {
        font-size: 10px;
    }
    .comment { display: block; } /* XXX comment visibility: none or block */

    </style>

</head>
<body>

    <div>
        <img id="plodLogo" src="image/PLOD-v0.1-48x48.png" alt="PLOD logo">
        <div>
            <span>Patient Locational Open Data (PLOD) Entry Form</span>
            <br>
            <span>注意事項的な記述がここに入る想定</span>
        </div>
    </div>
    <hr>

    <div class="divBlock">
        <div id="divBlockPublisher">
            <label for="divPublisher">所轄の自治体名:</label>
            <div id="divPublisher"></div>
            <!-- insert dynamically -->
        </div>
    </div>

    <div class="divBlock">
        <div id="divBlockPatientDisease">
            <label for="divPatientDisease">患者の病名:</label>
            <div id="divPatientDisease"></div>
            <!-- insert dynamically -->
        </div>

        <div id="divBlockDateConfirmed">
            <label for="dateConfirmed">患者の状態が確認された日付:</label>
            <input id="dateConfirmed" type="text" />
            <!-- insert dynamically -->
        </div>
    </div>

    <div class="divBlock">
        <div id="divBlockPatientAge">
            <label for="divPatientAge">患者の年代:</label>
            <div id="divPatientAge"></div>
            <!-- insert dynamically -->
        </div>

        <div id="divBlockPatientGender">
            <label for="divPatientGender">患者の性別:</label>
            <div id="divPatientGender"></div>
            <!-- insert dynamically -->
        </div>

        <div id="divBlockPatientResidence">
            <label for="divPatientResidence">患者の居住地域:</label>
            <div id="divPatientResidence"></div>
            <!-- insert dynamically -->
        </div>
    </div>

    <hr>
    <div class="divBlock" id="divPatientLocationHistoryBlock">
        <label for="divPatientLocationHistory">患者の移動の履歴:</label>
        <div id="divPatientLocationHistory">
            <table id="tablePatientLocationHistory" border=1>
                <tr>
                    <th>出発時間</th>
                    <th>出発地</th>
                    <th>到着時間</th>
                    <th>目的地</th>
                    <th>手段</th>
                    <th>所見や患者の行動、その他</th>
                </tr>
                <!-- insert dynamically -->
            </table>
            <input id="addLinePatientLocationHistory" type="button" value="行を増やす">
        </div>
    </div>

    <hr>
    <div class="divBlock" id="divPatientConditionHistoryBlock">
        <label for="divPatientConditionHistory">患者の状態の履歴:</label>
        <div id="divPatientConditionHistory">
            <table id="tablePatientConditionHistory" border=1>
                <tr>
                    <th>日付</th>
                    <th>健康状態</th>
                    <th>所見や状況、その他</th>
                </tr>
                <!-- insert dynamically -->
            </table>
            <input id="addLinePatientConditionHistory" type="button" value="行を増やす">
        </div>
    </div>

    <div>
        <input id="confirmButton" type="button" value="確認画面へ移動する。">
        <input id="submitButton" type="button" value="登録する。">
    </div>

    <hr>

    <div class="comment">XXX 整理できたらエクセルlikeな編集画面にする</div>
    <div class="comment">XXX 更新・確認もできたら便利</div>

    <div class="modal js-modal">
        <div class="modal-bg js-modal-close-no"></div>
        <div id="modal-content">
            <div>
                登録しますか？
                <input class="js-modal-close-no" type="button" value="いいえ">
                <input id="js-modal-close-yes" type="button" value="はい">
            </div>
            <hr>
            <div id="confirmMessage"></div>
        </div>
    </div>

</body>
</html>


